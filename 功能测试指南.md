# 功能测试指南

本文档说明如何测试STM32智能循迹小车的各项功能。

---

## 测试前准备

### 硬件准备
- [x] STM32小车硬件连接完成
- [x] 电池充满电
- [x] 蓝牙模块HC-05已配对
- [x] USB转TTL连接到电脑（用于查看串口输出）

### 软件准备
- [x] 串口助手（波特率115200）
- [x] 蓝牙串口助手（手机或电脑）
- [x] 黑线赛道准备好

---

## 一、基础功能测试

### 1.1 蓝牙连接测试

**步骤**：
1. 打开蓝牙串口助手
2. 搜索并连接"HC-05"（密码1234）
3. 连接成功后，发送命令 `Q`

**预期结果**：
```
MODE:1,STATION:0,STOP_TIME:10
```
- MODE:1 表示循迹模式
- STATION:0 表示未停靠过站点
- STOP_TIME:10 表示停靠时间10秒

### 1.2 模式切换测试

**步骤**：
1. 发送 `0` - 切换到停止模式
2. 发送 `Q` 查询状态
3. 发送 `1` - 切换到循迹模式
4. 发送 `Q` 查询状态
5. 发送 `2` - 切换到手动模式
6. 发送 `Q` 查询状态

**预期结果**：
```
MODE:0,STATION:0,STOP_TIME:10  // 停止模式
MODE:1,STATION:0,STOP_TIME:10  // 循迹模式
MODE:2,STATION:0,STOP_TIME:10  // 手动模式
```

### 1.3 手动控制测试

**步骤**：
1. 发送 `2` 进入手动模式
2. 发送 `F` - 前进
3. 观察小车前进
4. 发送 `S` - 停止
5. 发送 `B` - 后退
6. 观察小车后退
7. 发送 `S` - 停止
8. 发送 `L` - 左转
9. 观察小车左转
10. 发送 `S` - 停止
11. 发送 `R` - 右转
12. 观察小车右转
13. 发送 `S` - 停止

**预期结果**：
- 小车按命令执行相应动作
- 动作流畅，无卡顿

---

## 二、循迹功能测试

### 2.1 基础循迹测试

**步骤**：
1. 将小车放在黑线上
2. 发送 `1` 进入循迹模式
3. 观察小车沿黑线行驶

**预期结果**：
- 小车稳定沿黑线行驶
- 转弯时能够跟上
- 串口每秒输出：`STATUS:FORWARD`

### 2.2 站点停靠测试（核心功能）

**步骤**：
1. 在赛道上放置一条全黑线（站点标记）
2. 发送 `1` 进入循迹模式
3. 小车行驶到全黑线时观察

**预期结果**：
- 小车检测到全黑线后停止
- 串口输出：`STATUS:STOP,STATION:1`
- 小车停靠10秒（默认）
- 10秒后串口输出：`STATUS:FORWARD`
- 小车继续前进

**串口输出示例**：
```
STATUS:FORWARD
STATUS:FORWARD
STATUS:STOP,STATION:1    ← 检测到站点
STATUS:FORWARD           ← 10秒后恢复
STATUS:FORWARD
```

### 2.3 多站点测试

**步骤**：
1. 在赛道上放置3条全黑线（3个站点）
2. 发送 `1` 进入循迹模式
3. 观察小车依次停靠

**预期结果**：
```
STATUS:STOP,STATION:1
STATUS:FORWARD
STATUS:STOP,STATION:2
STATUS:FORWARD
STATUS:STOP,STATION:3
STATUS:FORWARD
```

### 2.4 停靠时间设置测试

**步骤**：
1. 发送 `0` 进入停止模式
2. 发送 `5` 设置停靠时间为5秒
3. 串口应返回：`STOP_TIME_SET:5`
4. 发送 `Q` 查询状态
5. 确认：`MODE:0,STATION:X,STOP_TIME:5`
6. 发送 `1` 进入循迹模式
7. 小车到达站点时，应停靠5秒

**预期结果**：
- 停靠时间可以设置为1-9秒
- 设置后立即生效

---

## 三、超声波测距测试

### 3.1 单次测距测试

**步骤**：
1. 在小车前方30cm处放置障碍物
2. 发送 `U` 命令

**预期结果**：
```
Distance: 30.XX cm
```

### 3.2 不同距离测试

**步骤**：
1. 分别在10cm、20cm、50cm、100cm处放置障碍物
2. 每次发送 `U` 命令测距

**预期结果**：
- 距离测量准确（误差±2cm）
- 无障碍物时返回：`Distance: ERROR (Timeout)`

---

## 四、状态上报测试

### 4.1 定时上报测试

**步骤**：
1. 打开串口助手
2. 发送 `1` 进入循迹模式
3. 观察串口输出

**预期结果**：
- 每秒输出一次：`STATUS:FORWARD`
- 停靠时输出：`STATUS:STOP,STATION:X`

### 4.2 手动模式上报测试

**步骤**：
1. 发送 `2` 进入手动模式
2. 观察串口输出

**预期结果**：
- 每秒输出一次：`STATUS:MANUAL`

---

## 五、综合测试

### 5.1 完整流程测试

**步骤**：
1. 连接蓝牙和串口
2. 发送 `0` 进入停止模式
3. 发送 `3` 设置停靠时间为3秒
4. 发送 `1` 进入循迹模式
5. 小车沿黑线行驶
6. 到达第一个站点，停靠3秒
7. 继续行驶到第二个站点，停靠3秒
8. 发送 `Q` 查询状态

**预期结果**：
```
STOP_TIME_SET:3
STATUS:FORWARD
STATUS:STOP,STATION:1
STATUS:FORWARD
STATUS:STOP,STATION:2
STATUS:FORWARD
MODE:1,STATION:2,STOP_TIME:3
```

---

## 六、性能测试

### 6.1 循迹速度测试

**测试项**：
- 直线速度
- 转弯速度
- 响应时间

**方法**：
- 测量小车通过1米直线的时间
- 测量小车通过90度弯道的时间

### 6.2 稳定性测试

**测试项**：
- 连续运行时间
- 多次停靠准确性
- 长时间运行后的性能

**方法**：
- 让小车连续运行30分钟
- 记录停靠次数和准确性

---

## 七、故障排查

### 问题1：小车不停靠

**可能原因**：
- 全黑线不够宽
- 传感器高度不合适
- 传感器损坏

**解决方法**：
1. 确保全黑线宽度≥10cm
2. 调整传感器高度（0.5-1cm）
3. 发送 `Q` 查看传感器状态

### 问题2：停靠时间不准确

**可能原因**：
- HAL_Delay函数不准确
- 系统时钟配置问题

**解决方法**：
1. 用秒表测量实际停靠时间
2. 检查系统时钟配置

### 问题3：串口无输出

**可能原因**：
- 串口未连接
- 波特率不匹配
- TX/RX接反

**解决方法**：
1. 检查串口连接
2. 确认波特率115200
3. 检查TX/RX连接

---

## 八、测试记录表

### 基础功能测试记录

| 测试项 | 预期结果 | 实际结果 | 通过/失败 | 备注 |
|--------|----------|----------|-----------|------|
| 蓝牙连接 | 连接成功 | | | |
| 模式切换 | 切换正常 | | | |
| 手动控制 | 动作正确 | | | |
| 循迹功能 | 沿线行驶 | | | |
| 站点停靠 | 停靠10秒 | | | |
| 时间设置 | 设置生效 | | | |
| 超声波测距 | 距离准确 | | | |
| 状态上报 | 每秒上报 | | | |

### 性能测试记录

| 测试项 | 目标值 | 实际值 | 通过/失败 | 备注 |
|--------|--------|--------|-----------|------|
| 直线速度 | ≥0.5m/s | | | |
| 转弯速度 | 顺利转弯 | | | |
| 停靠精度 | ±5cm | | | |
| 连续运行 | ≥30min | | | |

---

## 九、测试命令速查表

| 命令 | 功能 | 返回 |
|------|------|------|
| `0` | 停止模式 | - |
| `1` | 循迹模式 | - |
| `2` | 手动模式 | - |
| `F` | 前进 | - |
| `B` | 后退 | - |
| `L` | 左转 | - |
| `R` | 右转 | - |
| `S` | 停止 | - |
| `U` | 超声波测距 | `Distance: XX.XX cm` |
| `Q` | 查询状态 | `MODE:X,STATION:X,STOP_TIME:X` |
| `1-9` | 设置停靠时间 | `STOP_TIME_SET:X` |

---

## 十、测试完成检查清单

- [ ] 所有基础功能测试通过
- [ ] 循迹功能正常
- [ ] 站点停靠功能正常
- [ ] 停靠时间可设置
- [ ] 超声波测距准确
- [ ] 状态上报正常
- [ ] 性能达标
- [ ] 无明显bug
- [ ] 文档记录完整

---

**测试日期**：__________

**测试人员**：__________

**测试结果**：通过 / 失败

**备注**：
